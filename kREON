local Library = {}
Library.__index = Library

local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local function Create(class, props)
	local obj = Instance.new(class)
	for prop, value in pairs(props) do
		if prop ~= "Parent" then
			obj[prop] = value
		end
	end
	obj.Parent = props.Parent
	return obj
end

function Library.new(name)
	local self = setmetatable({}, Library)
	self.Name = name or "UI Library"
	self.Theme = {
		Main = Color3.fromRGB(25, 25, 30),
		Secondary = Color3.fromRGB(35, 35, 40),
		Accent = Color3.fromRGB(0, 170, 255),
		Text = Color3.fromRGB(240, 240, 240),
		Stroke = Color3.fromRGB(50, 50, 55)
	}
	
	self.ScreenGui = Create("ScreenGui", {
		Name = "UILibrary",
		ResetOnSpawn = false,
		ZIndexBehavior = Enum.ZIndexBehavior.Global,
		Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
	})
	
	self.Container = Create("Frame", {
		Name = "Container",
		BackgroundColor3 = self.Theme.Main,
		Position = UDim2.new(0.5, -200, 0.5, -250),
		Size = UDim2.new(0, 400, 0, 500),
		Parent = self.ScreenGui
	})
	
	Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = self.Container})
	
	Create("UIStroke", {
		Parent = self.Container,
		Color = self.Theme.Stroke,
		Thickness = 2,
		Transparency = 0
	})
	
	self.TopBar = Create("Frame", {
		Name = "TopBar",
		BackgroundColor3 = self.Theme.Secondary,
		Size = UDim2.new(1, 0, 0, 40),
		Parent = self.Container
	})
	
	Create("UICorner", {
		CornerRadius = UDim.new(0, 8),
		Parent = self.TopBar
	})
	
	self.Title = Create("TextLabel", {
		Name = "Title",
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 15, 0, 0),
		Size = UDim2.new(1, -30, 1, 0),
		Font = Enum.Font.GothamBold,
		Text = self.Name,
		TextColor3 = self.Theme.Text,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = self.TopBar
	})
	
	self.Content = Create("ScrollingFrame", {
		Name = "Content",
		Active = true,
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 0, 0, 50),
		Size = UDim2.new(1, 0, 1, -50),
		CanvasSize = UDim2.new(0, 0, 0, 0),
		ScrollBarThickness = 3,
		ScrollBarImageColor3 = self.Theme.Accent,
		Parent = self.Container
	})
	
	self.UIListLayout = Create("UIListLayout", {
		Parent = self.Content,
		Padding = UDim.new(0, 10),
		SortOrder = Enum.SortOrder.LayoutOrder
	})
	
	self.UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		self.Content.CanvasSize = UDim2.new(0, 0, 0, self.UIListLayout.AbsoluteContentSize.Y)
	end)
	
	self.Elements = {}
	
	local dragToggle
	local dragInput
	local dragStart
	local startPos
	
	local function UpdateInput(input)
		local delta = input.Position - dragStart
		self.Container.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
	
	self.TopBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragToggle = true
			dragStart = input.Position
			startPos = self.Container.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragToggle = false
				end
			end)
		end
	end)
	
	self.TopBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	
	game:GetService("UserInputService").InputChanged:Connect(function(input)
		if input == dragInput and dragToggle then
			UpdateInput(input)
		end
	end)
	
	return self
end

function Library:Window(name)
	local Window = {}
	
	Window.Section = Create("Frame", {
		Name = name,
		BackgroundColor3 = self.Theme.Secondary,
		Size = UDim2.new(1, -20, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = self.Content
	})
	
	Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = Window.Section})
	
	Create("UIStroke", {
		Parent = Window.Section,
		Color = self.Theme.Stroke,
		Thickness = 1
	})
	
	Window.Title = Create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 15, 0, 10),
		Size = UDim2.new(1, -30, 0, 20),
		Font = Enum.Font.GothamBold,
		Text = name,
		TextColor3 = self.Theme.Text,
		TextSize = 14,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = Window.Section
	})
	
	Window.Content = Create("Frame", {
		Name = "Content",
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 0, 0, 40),
		Size = UDim2.new(1, 0, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = Window.Section
	})
	
	Window.UIListLayout = Create("UIListLayout", {
		Parent = Window.Content,
		Padding = UDim.new(0, 8),
		SortOrder = Enum.SortOrder.LayoutOrder
	})
	
	function Window:Paragraph(text)
		local Paragraph = Create("TextLabel", {
			BackgroundTransparency = 1,
			Size = UDim2.new(1, -20, 0, 0),
			AutomaticSize = Enum.AutomaticSize.Y,
			Font = Enum.Font.Gotham,
			Text = text,
			TextColor3 = Color3.fromRGB(200, 200, 200),
			TextSize = 13,
			TextWrapped = true,
			TextXAlignment = Enum.TextXAlignment.Left,
			LayoutOrder = #self.Content:GetChildren(),
			Parent = self.Content
		})
		
		return Paragraph
	end
	
	function Window:Button(name, callback)
		local Button = Create("TextButton", {
			Name = name,
			BackgroundColor3 = self.Theme.Accent,
			Size = UDim2.new(1, -20, 0, 35),
			Font = Enum.Font.GothamSemibold,
			Text = name,
			TextColor3 = Color3.fromRGB(255, 255, 255),
			TextSize = 13,
			LayoutOrder = #self.Content:GetChildren(),
			Parent = self.Content
		})
		
		Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = Button})
		
		local Hover = Create("Frame", {
			Name = "Hover",
			BackgroundColor3 = Color3.fromRGB(255, 255, 255),
			BackgroundTransparency = 1,
			Size = UDim2.new(1, 0, 1, 0),
			Parent = Button
		})
		
		Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = Hover})
		
		Create("UIGradient", {
			Parent = Hover,
			Color = ColorSequence.new({
				ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
				ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
			}),
			Rotation = 90,
			Transparency = NumberSequence.new({
				NumberSequenceKeypoint.new(0, 0.9),
				NumberSequenceKeypoint.new(1, 0.9)
			})
		})
		
		Button.MouseButton1Click:Connect(function()
			if callback then
				callback()
			end
			TweenService:Create(Button, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(0, 140, 225)}):Play()
			task.wait(0.1)
			TweenService:Create(Button, TweenInfo.new(0.1), {BackgroundColor3 = self.Theme.Accent}):Play()
		end)
		
		Button.MouseEnter:Connect(function()
			TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(0, 180, 255)}):Play()
		end)
		
		Button.MouseLeave:Connect(function()
			TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = self.Theme.Accent}):Play()
		end)
		
		return Button
	end
	
	function Window:Toggle(name, default, callback)
		local Toggle = Create("Frame", {
			Name = name,
			BackgroundColor3 = self.Theme.Main,
			Size = UDim2.new(1, -20, 0, 30),
			LayoutOrder = #self.Content:GetChildren(),
			Parent = self.Content
		})
		
		Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = Toggle})
		
		Create("UIStroke", {
			Parent = Toggle,
			Color = self.Theme.Stroke,
			Thickness = 1
		})
		
		local Label = Create("TextLabel", {
			BackgroundTransparency = 1,
			Position = UDim2.new(0, 10, 0, 0),
			Size = UDim2.new(0.7, 0, 1, 0),
			Font = Enum.Font.Gotham,
			Text = name,
			TextColor3 = self.Theme.Text,
			TextSize = 13,
			TextXAlignment = Enum.TextXAlignment.Left,
			Parent = Toggle
		})
		
		local ToggleFrame = Create("Frame", {
			Name = "ToggleFrame",
			BackgroundColor3 = Color3.fromRGB(60, 60, 65),
			Position = UDim2.new(1, -45, 0.5, -10),
			Size = UDim2.new(0, 35, 0, 20),
			AnchorPoint = Vector2.new(1, 0.5),
			Parent = Toggle
		})
		
		Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = ToggleFrame})
		
		local ToggleCircle = Create("Frame", {
			Name = "ToggleCircle",
			BackgroundColor3 = Color3.fromRGB(220, 220, 220),
			Position = UDim2.new(0, 2, 0.5, -8),
			Size = UDim2.new(0, 16, 0, 16),
			AnchorPoint = Vector2.new(0, 0.5),
			Parent = ToggleFrame
		})
		
		Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = ToggleCircle})
		
		local Value = default or false
		
		local function Update()
			TweenService:Create(ToggleCircle, TweenInfo.new(0.2), {
				Position = Value and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
			}):Play()
			TweenService:Create(ToggleFrame, TweenInfo.new(0.2), {
				BackgroundColor3 = Value and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(60, 60, 65)
			}):Play()
			if callback then
				callback(Value)
			end
		end
		
		Toggle.MouseButton1Click:Connect(function()
			Value = not Value
			Update()
		end)
		
		Update()
		
		local ToggleObj = {}
		
		function ToggleObj:Set(value)
			Value = value
			Update()
		end
		
		function ToggleObj:Get()
			return Value
		end
		
		return ToggleObj
	end
	
	function Window:Slider(name, min, max, default, callback)
		local Slider = Create("Frame", {
			Name = name,
			BackgroundColor3 = self.Theme.Main,
			Size = UDim2.new(1, -20, 0, 60),
			LayoutOrder = #self.Content:GetChildren(),
			Parent = self.Content
		})
		
		Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = Slider})
		
		Create("UIStroke", {
			Parent = Slider,
			Color = self.Theme.Stroke,
			Thickness = 1
		})
		
		local Label = Create("TextLabel", {
			BackgroundTransparency = 1,
			Position = UDim2.new(0, 10, 0, 8),
			Size = UDim2.new(1, -20, 0, 20),
			Font = Enum.Font.Gotham,
			Text = name,
			TextColor3 = self.Theme.Text,
			TextSize = 13,
			TextXAlignment = Enum.TextXAlignment.Left,
			Parent = Slider
		})
		
		local ValueLabel = Create("TextLabel", {
			BackgroundTransparency = 1,
			Position = UDim2.new(1, -10, 0, 8),
			Size = UDim2.new(0, 50, 0, 20),
			AnchorPoint = Vector2.new(1, 0),
			Font = Enum.Font.GothamSemibold,
			Text = tostring(default or min),
			TextColor3 = self.Theme.Accent,
			TextSize = 13,
			TextXAlignment = Enum.TextXAlignment.Right,
			Parent = Slider
		})
		
		local SliderTrack = Create("Frame", {
			Name = "SliderTrack",
			BackgroundColor3 = Color3.fromRGB(50, 50, 55),
			Position = UDim2.new(0, 10, 1, -25),
			Size = UDim2.new(1, -20, 0, 6),
			Parent = Slider
		})
		
		Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = SliderTrack})
		
		local SliderFill = Create("Frame", {
			Name = "SliderFill",
			BackgroundColor3 = self.Theme.Accent,
			Size = UDim2.new(0, 0, 1, 0),
			Parent = SliderTrack
		})
		
		Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = SliderFill})
		
		local SliderButton = Create("TextButton", {
			Name = "SliderButton",
			BackgroundColor3 = Color3.fromRGB(255, 255, 255),
			Position = UDim2.new(0, -6, 0.5, -6),
			Size = UDim2.new(0, 12, 0, 12),
			AnchorPoint = Vector2.new(0, 0.5),
			AutoButtonColor = false,
			Text = "",
			Parent = SliderFill
		})
		
		Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = SliderButton})
		
		local Value = default or min
		
		local function Update(value)
			local percent = (value - min) / (max - min)
			SliderFill.Size = UDim2.new(percent, 0, 1, 0)
			ValueLabel.Text = tostring(math.floor(value))
			if callback then
				callback(value)
			end
		end
		
		local Dragging = false
		
		SliderButton.MouseButton1Down:Connect(function()
			Dragging = true
		end)
		
		game:GetService("UserInputService").InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				Dragging = false
			end
		end)
		
		SliderTrack.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				Dragging = true
				local percent = (input.Position.X - SliderTrack.AbsolutePosition.X) / SliderTrack.AbsoluteSize.X
				Value = math.floor(min + (max - min) * math.clamp(percent, 0, 1))
				Update(Value)
			end
		end)
		
		game:GetService("UserInputService").InputChanged:Connect(function(input)
			if Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
				local percent = (input.Position.X - SliderTrack.AbsolutePosition.X) / SliderTrack.AbsoluteSize.X
				Value = math.floor(min + (max - min) * math.clamp(percent, 0, 1))
				Update(Value)
			end
		end)
		
		Update(Value)
		
		local SliderObj = {}
		
		function SliderObj:Set(value)
			Value = math.clamp(value, min, max)
			Update(Value)
		end
		
		function SliderObj:Get()
			return Value
		end
		
		return SliderObj
	end
	
	function Window:Label(name)
		local Label = Create("TextLabel", {
			Name = name,
			BackgroundTransparency = 1,
			Size = UDim2.new(1, -20, 0, 20),
			Font = Enum.Font.GothamSemibold,
			Text = name,
			TextColor3 = self.Theme.Accent,
			TextSize = 13,
			TextXAlignment = Enum.TextXAlignment.Left,
			LayoutOrder = #self.Content:GetChildren(),
			Parent = self.Content
		})
		
		return Label
	end
	
	function Window:Dropdown(name, options, default, callback)
		local Dropdown = Create("Frame", {
			Name = name,
			BackgroundColor3 = self.Theme.Main,
			Size = UDim2.new(1, -20, 0, 30),
			LayoutOrder = #self.Content:GetChildren(),
			Parent = self.Content
		})
		
		Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = Dropdown})
		
		Create("UIStroke", {
			Parent = Dropdown,
			Color = self.Theme.Stroke,
			Thickness = 1
		})
		
		local Label = Create("TextLabel", {
			BackgroundTransparency = 1,
			Position = UDim2.new(0, 10, 0, 0),
			Size = UDim2.new(0.6, -10, 1, 0),
			Font = Enum.Font.Gotham,
			Text = name,
			TextColor3 = self.Theme.Text,
			TextSize = 13,
			TextXAlignment = Enum.TextXAlignment.Left,
			Parent = Dropdown
		})
		
		local Selected = Create("TextLabel", {
			BackgroundTransparency = 1,
			Position = UDim2.new(0.6, 0, 0, 0),
			Size = UDim2.new(0.4, -30, 1, 0),
			Font = Enum.Font.Gotham,
			Text = default or options[1] or "Select",
			TextColor3 = Color3.fromRGB(200, 200, 200),
			TextSize = 13,
			TextXAlignment = Enum.TextXAlignment.Right,
			Parent = Dropdown
		})
		
		local Arrow = Create("ImageLabel", {
			BackgroundTransparency = 1,
			Position = UDim2.new(1, -20, 0.5, -5),
			Size = UDim2.new(0, 10, 0, 10),
			AnchorPoint = Vector2.new(1, 0.5),
			Image = "rbxassetid://6031091004",
			ImageColor3 = Color3.fromRGB(200, 200, 200),
			Parent = Dropdown
		})
		
		local DropdownFrame = Create("ScrollingFrame", {
			Name = "DropdownFrame",
			BackgroundColor3 = self.Theme.Secondary,
			Position = UDim2.new(0, 0, 1, 5),
			Size = UDim2.new(1, 0, 0, 0),
			CanvasSize = UDim2.new(0, 0, 0, 0),
			ScrollBarThickness = 2,
			ScrollBarImageColor3 = self.Theme.Accent,
			Visible = false,
			Parent = Dropdown
		})
		
		Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = DropdownFrame})
		
		Create("UIStroke", {
			Parent = DropdownFrame,
			Color = self.Theme.Stroke,
			Thickness = 1
		})
		
		local UIListLayout = Create("UIListLayout", {
			Parent = DropdownFrame,
			SortOrder = Enum.SortOrder.LayoutOrder
		})
		
		local Expanded = false
		
		local function Toggle()
			Expanded = not Expanded
			DropdownFrame.Visible = Expanded
			TweenService:Create(DropdownFrame, TweenInfo.new(0.2), {
				Size = Expanded and UDim2.new(1, 0, 0, math.min(#options * 30, 150)) or UDim2.new(1, 0, 0, 0)
			}):Play()
			TweenService:Create(Arrow, TweenInfo.new(0.2), {
				Rotation = Expanded and 180 or 0
			}):Play()
		end
		
		for i, option in pairs(options) do
			local OptionButton = Create("TextButton", {
				BackgroundColor3 = self.Theme.Secondary,
				Size = UDim2.new(1, 0, 0, 30),
				Font = Enum.Font.Gotham,
				Text = option,
				TextColor3 = Color3.fromRGB(200, 200, 200),
				TextSize = 13,
				AutoButtonColor = false,
				LayoutOrder = i,
				Parent = DropdownFrame
			})
			
			OptionButton.MouseEnter:Connect(function()
				TweenService:Create(OptionButton, TweenInfo.new(0.2), {
					BackgroundColor3 = Color3.fromRGB(50, 50, 55)
				}):Play()
			end)
			
			OptionButton.MouseLeave:Connect(function()
				TweenService:Create(OptionButton, TweenInfo.new(0.2), {
					BackgroundColor3 = self.Theme.Secondary
				}):Play()
			end)
			
			OptionButton.MouseButton1Click:Connect(function()
				Selected.Text = option
				Toggle()
				if callback then
					callback(option)
				end
			end)
		end
		
		UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			DropdownFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
		end)
		
		Dropdown.MouseButton1Click:Connect(Toggle)
		
		local DropdownObj = {}
		
		function DropdownObj:Set(value)
			Selected.Text = value
			if callback then
				callback(value)
			end
		end
		
		function DropdownObj:Get()
			return Selected.Text
		end
		
		return DropdownObj
	end
	
	self.Elements[name] = Window
	return Window
end

function Library:Destroy()
	if self.ScreenGui then
		self.ScreenGui:Destroy()
	end
end
return Library
